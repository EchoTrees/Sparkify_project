# Sparkify-Project 成果汇总

## 项目背景
* 这是一个虚构的在线音乐流媒体网站Sparkify，数百万用户通过该网站的服务，使用免费套餐，或使用高级订阅模式，获得听取音乐更多权限。用户可以随时升级，降级或取消其服务。用户喜欢这项服务对于网站十分重要（涉及到用户的粘连，留存等）。每次用户与服务进行交互（即，降级服务，播放歌曲，注销，喜欢歌曲，添加歌单等）时，都会生成数据。所有这些数据都潜藏着有价值的信息，通过对于这些信息的挖掘分析，我们可以使用户的体验得到缇舍管并使网站得到更好的发展。我们感兴趣的目标是是否可以预测哪些用户有流失的风险。目标是在这些用户离开之前对其进行预测，以便用户可以在流失前获得优惠和奖励以减少用户流失率。

## 项目目的
* 对一个数字音乐服务公司的产品，建立一个模型来预测客户的流失情况

## 数据集
* mini_sparkify_event_data.json.bz2：该数据集包含sparkify用户行为日志。日志包含有关用户的一些基本信息以及有关单个操作的信息。

## 项目流程
* 加载清洗数据
* 探索性数据分析
* 特征工程
* 建模
* 模型选择并预测

## 项目所使用库
* pyspark.sql用于对数据进行处理清洗，
* pysapk.ml用于特征工程处理以及搭建机器学习模型

## 模型评估
* 准确率：Accuracy
 * F-1 Score

## 项目总结

* 在数据加载清洗中，我们首先在本地操作系统中将数据压缩成了bz2格式，然后对数据集进行加载，去除了可能存在空值的数据，去除了含有空字符串的用户
* 在探索性数据化分析中，我们首先定义了客户流失的行为特征，并将其通过（1，0）值对每个用户进行标记，并将时间相关特征转换成方便人阅读的格式
* 可视化分析中，我们探索了不同变量于用户流失之间的关系，我们发现：

    1. **男用户流失比女用户略多一点**
    2. **曾付费的用户反而比免费使用的用户流失的多，说明应用所提供的服务可能很不好**
    3. **点赞与差评之间的比值与用户流失与否有着一定的关系，比值越高的用户相对来说不容易流失**
    4. **流失的用户相对于没有流失的用户总体使用应用服务的时间要少一些**
    
* 我们对数据进行特征工程，包括特征筛选创建，聚合特征与标签，其中我们将level，gender特征转换为了int格式，方便模型训练，最后我们得出了7个特征一个目标标签的数据集；接着我们对特征进行向量化，并使用Nomalizer对特征进行归一化，得到最终数据集
* 我们将最终数据集拆分成训练集，验证集和测试集，并选取4个机器学习模型，对训练集进行训练
* 训练出的模型，通过验证集的预测，综合比较我们选择了**Random Forest**作为最佳的模型，并让该模型对测试集进行预测，并评价结果
* 最后观察结果发现**F-1 Score**比验证集预测有着较大的下滑，模型可能存在过拟合的问题，可以通过后续在本地环境中调参，尝试寻找更优的模型
* 还有一种可能是特征缩放器Nomalizer的效果可能没有别的缩放器好
* 另外在特征创建中，特征选择也可能影响到最后模型的表现对模型进行调参后发现当参数numTrees=20,maxDepth=10时模型表现最好，选择该参数重新训练模型并对测试集进行预测
最后得出结果： Best Model Metrics:

Accuracy: 0.7352941176470589

F-1 Score: 0.7036625971143174

* 结果表明，模型得到了优化，最后对模型进行特征重要性探索，发现**level**特征对于模型表现来说影响最大，**total_songs**相对来说重要性一般